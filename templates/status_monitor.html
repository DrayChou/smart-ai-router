<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[[ title ]]</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
        [v-cloak] { display: none; }
        .status-healthy { @apply bg-green-100 text-green-800; }
        .status-degraded { @apply bg-yellow-100 text-yellow-800; }
        .status-unhealthy { @apply bg-red-100 text-red-800; }
        .rank-badge { @apply inline-flex items-center px-2 py-1 rounded-full text-xs font-medium; }
        .rank-1 { @apply bg-green-100 text-green-800; }
        .rank-2 { @apply bg-blue-100 text-blue-800; }
        .rank-3 { @apply bg-purple-100 text-purple-800; }
        .rank-other { @apply bg-gray-100 text-gray-800; }
        .log-entry { @apply border-l-4 pl-4 py-2; }
        .log-success { @apply border-green-500; }
        .log-error { @apply border-red-500; }
        .log-warning { @apply border-yellow-500; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app" v-cloak class="min-h-screen">
        <!-- È°∂ÈÉ®ÂØºËà™ -->
        <nav class="bg-white shadow-sm border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <div class="flex items-center">
                        <h1 class="text-xl font-semibold text-gray-900">Smart AI Router - Áä∂ÊÄÅÁõëÊéß</h1>
                        <div class="ml-4 flex items-center space-x-2">
                            <div class="w-2 h-2 rounded-full" :class="connectionStatus ? 'bg-green-500' : 'bg-red-500'"></div>
                            <span class="text-sm text-gray-600">{{ connectionStatus ? 'Â∑≤ËøûÊé•' : 'Êú™ËøûÊé•' }}</span>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span class="text-sm text-gray-500">ÊúÄÂêéÊõ¥Êñ∞: {{ lastUpdate }}</span>
                        <button @click="refreshAll" class="px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700">
                            Âà∑Êñ∞
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- ‰∏ªË¶ÅÂÜÖÂÆπ -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <!-- Ê†áÁ≠æÈ°µÂØºËà™ -->
            <div class="border-b border-gray-200 mb-6">
                <nav class="-mb-px flex space-x-8">
                    <button v-for="tab in tabs" :key="tab.id"
                            @click="activeTab = tab.id"
                            :class="[
                                'py-2 px-1 border-b-2 font-medium text-sm',
                                activeTab === tab.id 
                                    ? 'border-blue-500 text-blue-600' 
                                    : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'
                            ]">
                        {{ tab.name }}
                        <span v-if="tab.count !== undefined" class="ml-2 px-2 py-1 bg-gray-100 text-gray-600 rounded-full text-xs">
                            {{ tab.count }}
                        </span>
                    </button>
                </nav>
            </div>

            <!-- Ê¶ÇËßà‰ª™Ë°®Êùø -->
            <div v-show="activeTab === 'overview'" class="space-y-6">
                <!-- ÁªüËÆ°Âç°Áâá -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <div class="bg-white overflow-hidden shadow rounded-lg">
                        <div class="p-5">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <div class="w-8 h-8 bg-green-500 rounded-md flex items-center justify-center">
                                        <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
                                        </svg>
                                    </div>
                                </div>
                                <div class="ml-5 w-0 flex-1">
                                    <dl>
                                        <dt class="text-sm font-medium text-gray-500 truncate">Ê¥ªË∑ÉÊ∏†ÈÅì</dt>
                                        <dd class="text-lg font-medium text-gray-900">{{ channelsStats.healthy_channels }}/{{ channelsStats.total_channels }}</dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white overflow-hidden shadow rounded-lg">
                        <div class="p-5">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <div class="w-8 h-8 bg-blue-500 rounded-md flex items-center justify-center">
                                        <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                        </svg>
                                    </div>
                                </div>
                                <div class="ml-5 w-0 flex-1">
                                    <dl>
                                        <dt class="text-sm font-medium text-gray-500 truncate">ÂèØÁî®Ê®°Âûã</dt>
                                        <dd class="text-lg font-medium text-gray-900">{{ totalAvailableModels }}</dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white overflow-hidden shadow rounded-lg">
                        <div class="p-5">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <div class="w-8 h-8 bg-red-500 rounded-md flex items-center justify-center">
                                        <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                                        </svg>
                                    </div>
                                </div>
                                <div class="ml-5 w-0 flex-1">
                                    <dl>
                                        <dt class="text-sm font-medium text-gray-500 truncate">ÈªëÂêçÂçï</dt>
                                        <dd class="text-lg font-medium text-gray-900">{{ blacklistStats.summary.total_blacklisted }}</dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white overflow-hidden shadow rounded-lg">
                        <div class="p-5">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <div class="w-8 h-8 bg-purple-500 rounded-md flex items-center justify-center">
                                        <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M2 10a8 8 0 018-8v8h8a8 8 0 11-16 0z"/>
                                            <path d="M12 2.252A8.014 8.014 0 0117.748 8H12V2.252z"/>
                                        </svg>
                                    </div>
                                </div>
                                <div class="ml-5 w-0 flex-1">
                                    <dl>
                                        <dt class="text-sm font-medium text-gray-500 truncate">ËØ∑Ê±ÇÊÄªÊï∞</dt>
                                        <dd class="text-lg font-medium text-gray-900">{{ requestLogs.length }}</dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Âø´ÈÄüÊ®°ÂûãÊêúÁ¥¢ -->
                <div class="bg-white shadow rounded-lg">
                    <div class="px-4 py-5 sm:p-6">
                        <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">Âø´ÈÄüÊ®°ÂûãÊêúÁ¥¢</h3>
                        <div class="flex space-x-3">
                            <input v-model="quickSearchQuery" 
                                   @keyup.enter="quickSearch"
                                   placeholder="ËæìÂÖ•Ê®°ÂûãÂêçÁß∞ÊàñÊ†áÁ≠æ (Â¶Ç: tag:free, gpt-4, claude)" 
                                   class="flex-1 border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <button @click="quickSearch" 
                                    :disabled="!quickSearchQuery.trim()"
                                    class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400">
                                ÊêúÁ¥¢
                            </button>
                        </div>
                        <div v-if="quickSearchResults.length > 0" class="mt-4">
                            <div class="text-sm text-gray-600 mb-2">
                                ÊâæÂà∞ {{ quickSearchResults.length }} ‰∏™ÂåπÈÖçÁªìÊûúÔºåÊåâË∑ØÁî±‰ºòÂÖàÁ∫ßÊéíÂ∫èÔºö
                            </div>
                            <div class="space-y-2 max-h-60 overflow-y-auto">
                                <div v-for="result in quickSearchResults.slice(0, 10)" :key="`${result.channel_id}-${result.model_name}`"
                                     class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                    <div class="flex items-center space-x-3">
                                        <span :class="[
                                            'rank-badge',
                                            result.rank === 1 ? 'rank-1' : result.rank === 2 ? 'rank-2' : result.rank === 3 ? 'rank-3' : 'rank-other'
                                        ]">
                                            #{{ result.rank }}
                                        </span>
                                        <div>
                                            <div class="font-medium">{{ result.model_name }}</div>
                                            <div class="text-sm text-gray-500">{{ result.channel_name }} ({{ result.provider }})</div>
                                        </div>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <span v-if="!result.available" class="px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs">
                                            ÈªëÂêçÂçï
                                        </span>
                                        <span class="text-sm text-gray-500">
                                            ËØÑÂàÜ: {{ (result.total_score || 0).toFixed(2) }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ê∏†ÈÅìÁä∂ÊÄÅ -->
            <div v-show="activeTab === 'channels'" class="space-y-6">
                <div class="bg-white shadow overflow-hidden sm:rounded-md">
                    <ul class="divide-y divide-gray-200">
                        <li v-for="channel in channels" :key="channel.id" class="px-6 py-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0">
                                        <div class="w-3 h-3 rounded-full" 
                                             :class="channel.status === 'healthy' ? 'bg-green-400' : 
                                                     channel.status === 'degraded' ? 'bg-yellow-400' : 'bg-red-400'">
                                        </div>
                                    </div>
                                    <div class="ml-4">
                                        <div class="flex items-center space-x-2">
                                            <p class="text-sm font-medium text-gray-900">{{ channel.name }}</p>
                                            <span :class="[
                                                'px-2 inline-flex text-xs leading-5 font-semibold rounded-full',
                                                'status-' + channel.status
                                            ]">
                                                {{ channel.status === 'healthy' ? 'ÂÅ•Â∫∑' : 
                                                   channel.status === 'degraded' ? 'ÈôçÁ∫ß' : '‰∏çÂèØÁî®' }}
                                            </span>
                                        </div>
                                        <div class="text-sm text-gray-500">
                                            {{ channel.provider }} | ‰ºòÂÖàÁ∫ß: {{ channel.priority }} | ÂÅ•Â∫∑ÂàÜÊï∞: {{ (channel.health_score * 100).toFixed(1) }}%
                                        </div>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-4">
                                    <div class="text-right text-sm">
                                        <div class="text-gray-900">{{ channel.available_models }}/{{ channel.total_models }} ÂèØÁî®</div>
                                        <div class="text-gray-500">{{ channel.blacklisted_models }} Ë¢´Â±èËîΩ</div>
                                    </div>
                                    <button @click="viewChannelModels(channel)" 
                                            class="text-blue-600 hover:text-blue-900 text-sm font-medium">
                                        Êü•ÁúãÊ®°Âûã
                                    </button>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Ê®°ÂûãÊêúÁ¥¢ -->
            <div v-show="activeTab === 'search'" class="space-y-6">
                <div class="bg-white shadow rounded-lg">
                    <div class="px-4 py-5 sm:p-6">
                        <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">Ê®°ÂûãÊêúÁ¥¢ÊµãËØï</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ÊêúÁ¥¢Êü•ËØ¢</label>
                                <input v-model="searchQuery" 
                                       placeholder="ÊîØÊåÅÊ®°ÂûãÂêçÁß∞„ÄÅÊ†áÁ≠æ (tag:free)„ÄÅÂèÇÊï∞ÈáèÊØîËæÉ (>7b) Á≠â"
                                       class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div class="flex space-x-3">
                                <button @click="searchModels" 
                                        :disabled="!searchQuery.trim() || searching"
                                        class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-gray-400">
                                    {{ searching ? 'ÊêúÁ¥¢‰∏≠...' : 'ÊêúÁ¥¢Ê®°Âûã' }}
                                </button>
                                <button @click="clearSearch" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400">
                                    Ê∏ÖÈô§
                                </button>
                            </div>
                        </div>

                        <!-- ÊêúÁ¥¢ÁªìÊûú -->
                        <div v-if="searchResults.length > 0" class="mt-6">
                            <div class="flex justify-between items-center mb-4">
                                <h4 class="text-md font-medium text-gray-900">
                                    ÊêúÁ¥¢ÁªìÊûú ({{ searchResults.length }}/{{ searchTotalMatches }})
                                </h4>
                                <div class="text-sm text-gray-500">
                                    Ë∑ØÁî±Á≠ñÁï•: {{ searchStrategy }}
                                </div>
                            </div>
                            
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ÊéíÂêç</th>
                                            <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ê®°Âûã</th>
                                            <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ê∏†ÈÅì</th>
                                            <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ËÉΩÂäõ</th>
                                            <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Áä∂ÊÄÅ</th>
                                            <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ËØÑÂàÜ</th>
                                            <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ÊàêÊú¨</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        <tr v-for="result in searchResults" :key="`${result.channel_id}-${result.model_name}`"
                                            :class="[
                                                result.available ? '' : 'bg-red-50',
                                                result.rank <= 3 ? 'border-l-4' : '',
                                                result.rank === 1 ? 'border-green-400' : 
                                                result.rank === 2 ? 'border-blue-400' : 
                                                result.rank === 3 ? 'border-purple-400' : ''
                                            ]">
                                            <td class="px-3 py-4 whitespace-nowrap text-sm">
                                                <span :class="[
                                                    'rank-badge',
                                                    result.rank === 1 ? 'rank-1' : result.rank === 2 ? 'rank-2' : result.rank === 3 ? 'rank-3' : 'rank-other'
                                                ]">
                                                    #{{ result.rank }}
                                                </span>
                                            </td>
                                            <td class="px-3 py-4 whitespace-nowrap">
                                                <div class="text-sm font-medium text-gray-900">{{ result.model_name }}</div>
                                            </td>
                                            <td class="px-3 py-4 whitespace-nowrap">
                                                <div class="text-sm text-gray-900">{{ result.channel_name }}</div>
                                                <div class="text-sm text-gray-500">{{ result.provider }}</div>
                                            </td>
                                            <td class="px-3 py-4 whitespace-nowrap">
                                                <div class="flex flex-wrap gap-1">
                                                    <span class="capability-badge text-xs px-2 py-1 rounded-full bg-blue-100 text-blue-800">
                                                        üí¨ ÊñáÊú¨
                                                    </span>
                                                    <span v-if="result.capabilities && result.capabilities.includes('vision')" 
                                                          class="capability-badge text-xs px-2 py-1 rounded-full bg-green-100 text-green-800">
                                                        üñºÔ∏è ÂõæÂÉè
                                                    </span>
                                                    <span v-if="result.capabilities && result.capabilities.includes('function_calling')" 
                                                          class="capability-badge text-xs px-2 py-1 rounded-full bg-purple-100 text-purple-800">
                                                        üîß Â∑•ÂÖ∑
                                                    </span>
                                                    <span v-if="result.capabilities && result.capabilities.includes('code_generation')" 
                                                          class="capability-badge text-xs px-2 py-1 rounded-full bg-yellow-100 text-yellow-800">
                                                        üíª ‰ª£Á†Å
                                                    </span>
                                                    <span v-if="result.capabilities && result.capabilities.includes('json_mode')" 
                                                          class="capability-badge text-xs px-2 py-1 rounded-full bg-indigo-100 text-indigo-800">
                                                        üìã JSON
                                                    </span>
                                                </div>
                                                <div v-if="result.context_length" class="text-xs text-gray-500 mt-1">
                                                    üìè {{ formatContextLength(result.context_length) }}
                                                </div>
                                            </td>
                                            <td class="px-3 py-4 whitespace-nowrap">
                                                <span v-if="result.available" class="px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs">
                                                    ÂèØÁî®
                                                </span>
                                                <span v-else class="px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs">
                                                    {{ result.blacklist_reason || '‰∏çÂèØÁî®' }}
                                                </span>
                                            </td>
                                            <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <div>ÊÄªÂàÜ: {{ (result.total_score || 0).toFixed(2) }}</div>
                                                <div class="text-xs">
                                                    ÊàêÊú¨:{{ (result.cost_score || 0).toFixed(1) }} 
                                                    ÈÄüÂ∫¶:{{ (result.speed_score || 0).toFixed(1) }}
                                                </div>
                                            </td>
                                            <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <div v-if="result.estimated_cost.input">
                                                    <div class="font-mono">{{ formatCost(result.estimated_cost.input) }}</div>
                                                    <div v-if="result.estimated_cost.currency_discount" class="text-xs text-green-600">
                                                        üí∞ {{ result.estimated_cost.currency_discount }}ÊäòÊâ£
                                                    </div>
                                                </div>
                                                <div v-else class="text-gray-400">Êú™Áü•</div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ËØ∑Ê±ÇÊó•Âøó -->
            <div v-show="activeTab === 'logs'" class="space-y-6">
                <div class="bg-white shadow rounded-lg">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg leading-6 font-medium text-gray-900">ÂÆûÊó∂ËØ∑Ê±ÇÊó•Âøó</h3>
                            <button @click="refreshLogs" class="text-blue-600 hover:text-blue-900 text-sm font-medium">
                                Âà∑Êñ∞Êó•Âøó
                            </button>
                        </div>
                        
                        <div class="space-y-2 max-h-96 overflow-y-auto">
                            <div v-for="log in requestLogs.slice().reverse().slice(0, 50)" :key="log.timestamp"
                                 :class="[
                                     'log-entry',
                                     log.status_code >= 200 && log.status_code < 300 ? 'log-success' :
                                     log.status_code >= 400 ? 'log-error' : 'log-warning'
                                 ]">
                                <div class="flex justify-between items-start">
                                    <div class="flex-1">
                                        <div class="flex items-center space-x-2">
                                            <span class="font-medium">{{ log.method }}</span>
                                            <span class="text-gray-600">{{ log.path }}</span>
                                            <span :class="[
                                                'px-2 py-1 rounded text-xs',
                                                log.status_code >= 200 && log.status_code < 300 ? 'bg-green-100 text-green-800' :
                                                log.status_code >= 400 ? 'bg-red-100 text-red-800' : 'bg-yellow-100 text-yellow-800'
                                            ]">
                                                {{ log.status_code }}
                                            </span>
                                        </div>
                                        <div v-if="log.model || log.channel" class="text-sm text-gray-600 mt-1">
                                            <span v-if="log.model">Ê®°Âûã: {{ log.model }}</span>
                                            <span v-if="log.channel" class="ml-4">Ê∏†ÈÅì: {{ log.channel }}</span>
                                        </div>
                                        <div v-if="log.error" class="text-sm text-red-600 mt-1">
                                            ÈîôËØØ: {{ log.error }}
                                        </div>
                                    </div>
                                    <div class="text-right text-sm text-gray-500">
                                        <div>{{ formatTime(log.timestamp) }}</div>
                                        <div>{{ log.duration_ms.toFixed(1) }}ms</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÈªëÂêçÂçïÁä∂ÊÄÅ -->
            <div v-show="activeTab === 'blacklist'" class="space-y-6">
                <div class="bg-white shadow rounded-lg">
                    <div class="px-4 py-5 sm:p-6">
                        <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">ÈªëÂêçÂçïÁªüËÆ°</h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            <div class="text-center p-4 bg-gray-50 rounded-lg">
                                <div class="text-2xl font-bold text-gray-900">{{ blacklistStats.summary.total_blacklisted }}</div>
                                <div class="text-sm text-gray-600">ÊÄªËÆ°</div>
                            </div>
                            <div class="text-center p-4 bg-red-50 rounded-lg">
                                <div class="text-2xl font-bold text-red-600">{{ blacklistStats.summary.permanent }}</div>
                                <div class="text-sm text-gray-600">Ê∞∏‰πÖ</div>
                            </div>
                            <div class="text-center p-4 bg-yellow-50 rounded-lg">
                                <div class="text-2xl font-bold text-yellow-600">{{ blacklistStats.summary.temporary }}</div>
                                <div class="text-sm text-gray-600">‰∏¥Êó∂</div>
                            </div>
                        </div>

                        <div v-if="Object.keys(blacklistStats.by_error_type).length > 0" class="mb-6">
                            <h4 class="text-md font-medium text-gray-900 mb-3">ÊåâÈîôËØØÁ±ªÂûãÂàÜÂ∏É</h4>
                            <div class="space-y-2">
                                <div v-for="(count, errorType) in blacklistStats.by_error_type" :key="errorType"
                                     class="flex justify-between items-center p-2 bg-gray-50 rounded">
                                    <span class="text-sm font-medium">{{ errorType }}</span>
                                    <span class="text-sm text-gray-600">{{ count }}</span>
                                </div>
                            </div>
                        </div>

                        <div v-if="Object.keys(blacklistStats.by_channel).length > 0">
                            <h4 class="text-md font-medium text-gray-900 mb-3">ÊåâÊ∏†ÈÅìÂàÜÂ∏É</h4>
                            <div class="space-y-3">
                                <div v-for="(models, channelId) in blacklistStats.by_channel" :key="channelId"
                                     class="border border-gray-200 rounded-lg p-3">
                                    <div class="font-medium text-gray-900 mb-2">{{ channelId }}</div>
                                    <div class="space-y-1">
                                        <div v-for="model in models" :key="model.model"
                                             class="flex justify-between items-center text-sm">
                                            <span>{{ model.model }}</span>
                                            <div class="flex items-center space-x-2">
                                                <span class="text-gray-500">{{ model.error_type }}</span>
                                                <span v-if="model.remaining_time > 0" class="text-blue-600">
                                                    {{ Math.ceil(model.remaining_time / 60) }}ÂàÜÈíüÂêéÊÅ¢Â§ç
                                                </span>
                                                <span v-else class="text-red-600">Ê∞∏‰πÖ</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ê®°ÂûãËØ¶ÊÉÖÊ®°ÊÄÅÊ°Ü -->
        <div v-if="showModelModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
            <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-medium text-gray-900">{{ selectedChannel.name }} - Ê®°ÂûãÂàóË°®</h3>
                    <button @click="showModelModal = false" class="text-gray-400 hover:text-gray-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                
                <div class="max-h-96 overflow-y-auto">
                    <div v-if="channelModels.length === 0" class="text-center py-8 text-gray-500">
                        ÊöÇÊó†Ê®°ÂûãÊï∞ÊçÆ
                    </div>
                    <div v-else class="space-y-2">
                        <div v-for="model in channelModels" :key="model.id"
                             class="flex justify-between items-center p-3 border border-gray-200 rounded-lg">
                            <div class="flex-1">
                                <div class="font-medium">{{ model.name }}</div>
                                <div class="text-sm text-gray-500">
                                    <span v-if="model.parameter_count">{{ model.parameter_count }} ÂèÇÊï∞ | </span>
                                    <span v-if="model.context_length">{{ model.context_length }} ‰∏ä‰∏ãÊñá</span>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span v-if="model.available" class="px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs">
                                    ÂèØÁî®
                                </span>
                                <span v-else class="px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs">
                                    ÈªëÂêçÂçï
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue

        createApp({
            data() {
                return {
                    activeTab: 'overview',
                    connectionStatus: false,
                    lastUpdate: '',
                    websocket: null,
                    
                    // Ê†áÁ≠æÈ°µÈÖçÁΩÆ
                    tabs: [
                        { id: 'overview', name: 'Ê¶ÇËßà', count: undefined },
                        { id: 'channels', name: 'Ê∏†ÈÅìÁä∂ÊÄÅ', count: undefined },
                        { id: 'search', name: 'Ê®°ÂûãÊêúÁ¥¢', count: undefined },
                        { id: 'logs', name: 'ËØ∑Ê±ÇÊó•Âøó', count: undefined },
                        { id: 'blacklist', name: 'ÈªëÂêçÂçï', count: undefined }
                    ],
                    
                    // Êï∞ÊçÆÁä∂ÊÄÅ
                    channels: [],
                    channelsStats: { total_channels: 0, healthy_channels: 0 },
                    requestLogs: [],
                    blacklistStats: { summary: { total_blacklisted: 0, permanent: 0, temporary: 0 }, by_channel: {}, by_error_type: {} },
                    
                    // ÊêúÁ¥¢ÂäüËÉΩ
                    quickSearchQuery: '',
                    quickSearchResults: [],
                    searchQuery: '',
                    searchResults: [],
                    searchTotalMatches: 0,
                    searchStrategy: '',
                    searching: false,
                    
                    // Ê®°ÊÄÅÊ°Ü
                    showModelModal: false,
                    selectedChannel: {},
                    channelModels: []
                }
            },
            
            computed: {
                totalAvailableModels() {
                    return this.channels.reduce((sum, channel) => sum + channel.available_models, 0)
                }
            },
            
            async mounted() {
                await this.initializeData()
                this.connectWebSocket()
                this.updateLastUpdate()
                
                // ËÆæÁΩÆÂÆöÊó∂Âà∑Êñ∞
                setInterval(() => {
                    this.refreshAll()
                }, 30000) // 30ÁßíÂà∑Êñ∞‰∏ÄÊ¨°
            },
            
            methods: {
                async initializeData() {
                    await Promise.all([
                        this.loadChannels(),
                        this.loadLogs(),
                        this.loadBlacklistStats()
                    ])
                },
                
                async loadChannels() {
                    try {
                        const response = await axios.get('/status/api/channels')
                        this.channels = response.data.channels
                        this.channelsStats = {
                            total_channels: response.data.total_channels,
                            healthy_channels: response.data.healthy_channels
                        }
                        this.tabs[1].count = this.channels.length
                    } catch (error) {
                        console.error('Âä†ËΩΩÊ∏†ÈÅìÊï∞ÊçÆÂ§±Ë¥•:', error)
                    }
                },
                
                async loadLogs() {
                    try {
                        const response = await axios.get('/status/api/logs?limit=100')
                        this.requestLogs = response.data.logs
                        this.tabs[3].count = this.requestLogs.length
                    } catch (error) {
                        console.error('Âä†ËΩΩÊó•ÂøóÂ§±Ë¥•:', error)
                    }
                },
                
                async loadBlacklistStats() {
                    try {
                        const response = await axios.get('/status/api/blacklist')
                        this.blacklistStats = response.data
                        this.tabs[4].count = this.blacklistStats.summary.total_blacklisted
                    } catch (error) {
                        console.error('Âä†ËΩΩÈªëÂêçÂçïÁªüËÆ°Â§±Ë¥•:', error)
                    }
                },
                
                async searchModels() {
                    if (!this.searchQuery.trim()) return
                    
                    this.searching = true
                    try {
                        const response = await axios.post('/status/api/search', {
                            query: this.searchQuery,
                            max_results: 50
                        })
                        
                        this.searchResults = response.data.matches
                        this.searchTotalMatches = response.data.total_matches
                        this.searchStrategy = response.data.routing_strategy
                    } catch (error) {
                        console.error('ÊêúÁ¥¢Â§±Ë¥•:', error)
                        this.searchResults = []
                    } finally {
                        this.searching = false
                    }
                },
                
                async quickSearch() {
                    if (!this.quickSearchQuery.trim()) return
                    
                    try {
                        const response = await axios.post('/status/api/search', {
                            query: this.quickSearchQuery,
                            max_results: 10
                        })
                        this.quickSearchResults = response.data.matches
                    } catch (error) {
                        console.error('Âø´ÈÄüÊêúÁ¥¢Â§±Ë¥•:', error)
                        this.quickSearchResults = []
                    }
                },
                
                clearSearch() {
                    this.searchQuery = ''
                    this.searchResults = []
                    this.searchTotalMatches = 0
                    this.searchStrategy = ''
                },
                
                async viewChannelModels(channel) {
                    this.selectedChannel = channel
                    try {
                        const response = await axios.get(`/status/api/channels/${channel.id}/models`)
                        this.channelModels = response.data.models
                        this.showModelModal = true
                    } catch (error) {
                        console.error('Âä†ËΩΩÊ∏†ÈÅìÊ®°ÂûãÂ§±Ë¥•:', error)
                        this.channelModels = []
                        this.showModelModal = true
                    }
                },
                
                async refreshAll() {
                    await this.initializeData()
                    this.updateLastUpdate()
                },
                
                async refreshLogs() {
                    await this.loadLogs()
                },
                
                connectWebSocket() {
                    try {
                        const protocol = location.protocol === 'https:' ? 'wss:' : 'ws:'
                        this.websocket = new WebSocket(`${protocol}//${location.host}/status/ws`)
                        
                        this.websocket.onopen = () => {
                            this.connectionStatus = true
                            console.log('WebSocket ËøûÊé•Â∑≤Âª∫Á´ã')
                        }
                        
                        this.websocket.onmessage = (event) => {
                            const message = JSON.parse(event.data)
                            this.handleWebSocketMessage(message)
                        }
                        
                        this.websocket.onclose = () => {
                            this.connectionStatus = false
                            console.log('WebSocket ËøûÊé•Â∑≤Êñ≠ÂºÄ')
                            // Â∞ùËØïÈáçËøû
                            setTimeout(() => this.connectWebSocket(), 5000)
                        }
                        
                        this.websocket.onerror = (error) => {
                            console.error('WebSocket ÈîôËØØ:', error)
                            this.connectionStatus = false
                        }
                    } catch (error) {
                        console.error('WebSocket ËøûÊé•Â§±Ë¥•:', error)
                        this.connectionStatus = false
                    }
                },
                
                handleWebSocketMessage(message) {
                    if (message.type === 'request_log') {
                        this.requestLogs.push(message.data)
                        if (this.requestLogs.length > 1000) {
                            this.requestLogs = this.requestLogs.slice(-1000)
                        }
                        this.tabs[3].count = this.requestLogs.length
                    }
                    // ÂèØ‰ª•Ê∑ªÂä†Êõ¥Â§öÊ∂àÊÅØÁ±ªÂûãÁöÑÂ§ÑÁêÜ
                },
                
                formatTime(timestamp) {
                    return new Date(timestamp).toLocaleTimeString('zh-CN')
                },
                
                formatContextLength(contextLength) {
                    if (!contextLength) return 'Êú™Áü•'
                    if (contextLength >= 1000000) {
                        return (contextLength / 1000000).toFixed(1) + 'M'
                    } else if (contextLength >= 1000) {
                        return (contextLength / 1000).toFixed(0) + 'K'
                    } else {
                        return contextLength.toString()
                    }
                },
                
                formatCost(cost) {
                    if (!cost || cost === 0) return 'Free'
                    
                    // ÂêéÁ´ØËøîÂõûÊØèÁôæ‰∏átoken‰ª∑Ê†ºÔºåÁõ¥Êé•‰ΩøÁî®
                    const costPerMillion = cost
                    
                    if (costPerMillion < 0.01) {
                        // Â∞è‰∫é0.01ÁöÑÔºåÊòæÁ§∫4‰ΩçÂ∞èÊï∞
                        return `$${costPerMillion.toFixed(4)}/1M`
                    } else if (costPerMillion < 1) {
                        // Â∞è‰∫é1ÁöÑÔºåÊòæÁ§∫3‰ΩçÂ∞èÊï∞
                        return `$${costPerMillion.toFixed(3)}/1M`
                    } else if (costPerMillion < 100) {
                        // Â∞è‰∫é100ÁöÑÔºåÊòæÁ§∫2‰ΩçÂ∞èÊï∞
                        return `$${costPerMillion.toFixed(2)}/1M`
                    } else {
                        // Â§ß‰∫é100ÁöÑÔºåÊòæÁ§∫1‰ΩçÂ∞èÊï∞
                        return `$${costPerMillion.toFixed(1)}/1M`
                    }
                },
                
                updateLastUpdate() {
                    this.lastUpdate = new Date().toLocaleTimeString('zh-CN')
                }
            }
        }).mount('#app')
    </script>
</body>
</html>