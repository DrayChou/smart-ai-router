# ğŸš€ Smart AI Router

è½»é‡åŒ–ä¸ªäººAIæ™ºèƒ½è·¯ç”±ç³»ç»Ÿ - **æˆæœ¬ä¼˜åŒ–** | **æ™ºèƒ½è·¯ç”±** | **æ•…éšœè½¬ç§»**

## âœ¨ ç‰¹æ€§

### ğŸ§  æ ¸å¿ƒåŠŸèƒ½
- **ğŸ¯ Provider/Channel/Model Groupæ¶æ„** - å‚è€ƒOpenRouter autoæ¨¡å‹ï¼Œæ”¯æŒProviderâ†’Channelâ†’Model Groupä¸‰å±‚æ¶æ„
- **ğŸ’° æ™ºèƒ½æˆæœ¬ä¼˜åŒ–** - å¤šå±‚è·¯ç”±ç­–ç•¥ï¼Œè‡ªåŠ¨é€‰æ‹©æˆæœ¬æœ€ä¼˜æ¸ é“
- **âš¡ å¤šç­–ç•¥è·¯ç”±** - æˆæœ¬/é€Ÿåº¦/ä¼˜å…ˆçº§/è´Ÿè½½å‡è¡¡ç­‰å¤šå±‚æ¬¡æ™ºèƒ½è·¯ç”±
- **ğŸ”„ è‡ªåŠ¨æ•…éšœè½¬ç§»** - æ™ºèƒ½é”™è¯¯åˆ†ç±»ï¼Œè‡ªåŠ¨å†·å´æ¢å¤æœºåˆ¶
- **ğŸ“‹ çµæ´»é…é¢ç®¡ç†** - æ¯æ¸ é“ç‹¬ç«‹çš„æ¯æ—¥é™é¢ä¸è‡ªåŠ¨é‡ç½®

### ğŸ›¡ï¸ é«˜çº§ç‰¹æ€§
- **ğŸ“Š å®æ—¶æˆæœ¬ç›‘æ§** - åŠ¨æ€ä»·æ ¼ç­–ç•¥ï¼Œæˆæœ¬åˆ†æå’Œé¢„ç®—æ§åˆ¶
- **ğŸ” å¥åº·çŠ¶æ€æ£€æŸ¥** - æŒç»­ç›‘æ§æ¸ é“å¥åº·åº¦å’Œæ€§èƒ½æŒ‡æ ‡
- **ğŸ›ï¸ èƒ½åŠ›ç­›é€‰è·¯ç”±** - æ”¯æŒfunction_callingã€visionã€ä»£ç ç”Ÿæˆç­‰èƒ½åŠ›è¿‡æ»¤
- **ğŸ“ˆ æ•°æ®ç»Ÿè®¡åˆ†æ** - è¯·æ±‚é‡ã€æˆåŠŸç‡ã€æˆæœ¬è¶‹åŠ¿ç­‰è¯¦ç»†ç»Ÿè®¡
- **ğŸŒ å¤šå‚å•†æ”¯æŒ** - æ”¯æŒå®˜æ–¹/èšåˆ/è½¬å”®å•†ç­‰å¤šç§Providerç±»å‹
- **âš™ï¸ åŠ¨æ€é…ç½®ç®¡ç†** - æ•°æ®åº“é©±åŠ¨ï¼Œæ”¯æŒå®æ—¶é…ç½®æ— éœ€é‡å¯

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
smart-ai-router/
â”œâ”€â”€ core/                    # æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
â”‚   â”œâ”€â”€ models/             # SQLAlchemyæ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ router/             # æ™ºèƒ½è·¯ç”±å¼•æ“
â”‚   â”œâ”€â”€ manager/            # æ¸ é“/å¯†é’¥/æ¨¡å‹ç»„ç®¡ç†å™¨
â”‚   â”œâ”€â”€ providers/          # Provideré€‚é…å™¨å®ç°
â”‚   â””â”€â”€ scheduler/          # å®šæ—¶ä»»åŠ¡å’Œç›‘æ§
â”œâ”€â”€ api/                     # FastAPIè·¯ç”±æ¥å£
â”œâ”€â”€ config/                  # é…ç½®æ–‡ä»¶(YAML)
â”‚   â”œâ”€â”€ providers.yaml      # Provideré…ç½®
â”‚   â”œâ”€â”€ model_groups.yaml   # Model Groupé…ç½®
â”‚   â”œâ”€â”€ system.yaml         # ç³»ç»Ÿé…ç½®
â”‚   â””â”€â”€ pricing_policies.yaml # åŠ¨æ€ä»·æ ¼ç­–ç•¥
â”œâ”€â”€ web/                     # Webç®¡ç†ç•Œé¢(å¯é€‰)
â”œâ”€â”€ tests/                   # æµ‹è¯•æ–‡ä»¶
â””â”€â”€ docs/                    # æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Python 3.9+
- uv åŒ…ç®¡ç†å™¨

### å®‰è£…ä¾èµ–
```bash
# å…‹éš†ä»“åº“
git clone <your-repo-url>
cd smart-ai-router

# ä½¿ç”¨ uv å®‰è£…ä¾èµ–
uv sync

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source .venv/bin/activate  # Linux/Mac
# .venv\Scripts\activate   # Windows
```

### é…ç½®ç³»ç»Ÿ
```bash
# å¤åˆ¶é…ç½®æ¨¡æ¿
cp config/example.yaml config/config.yaml
cp .env.example .env

# ç¼–è¾‘ç¯å¢ƒå˜é‡æ–‡ä»¶ï¼Œæ·»åŠ å¿…è¦çš„APIå¯†é’¥
# vi .env

# æ³¨æ„ï¼šå…·ä½“çš„Channelå’ŒAPIå¯†é’¥é…ç½®é€šè¿‡Webç®¡ç†ç•Œé¢è¿›è¡Œ
# æ— éœ€æ‰‹åŠ¨ç¼–è¾‘YAMLé…ç½®æ–‡ä»¶
```

### å¯åŠ¨æœåŠ¡
```bash
# å¼€å‘æ¨¡å¼
uvicorn main:app --host 0.0.0.0 --port 8000 --reload

# ç”Ÿäº§æ¨¡å¼
python main.py
```

## âš™ï¸ æ¶æ„ç¤ºä¾‹

### Model Groupé…ç½®ç¤ºä¾‹
```yaml
# config/model_groups.yaml
model_groups:
  auto:free:
    display_name: "å…è´¹æ¨¡å‹ç»„"
    description: "åŒ…å«æ‰€æœ‰å…è´¹AIæ¨¡å‹ï¼ŒæŒ‰é€Ÿåº¦å’Œå¯ç”¨æ€§æ™ºèƒ½è·¯ç”±"
    
    # å¤šå±‚æ’åºç­–ç•¥
    routing_strategy:
      - field: "effective_cost"     # è€ƒè™‘å€ç‡åçš„å®é™…æˆæœ¬
        order: "asc"
        weight: 1.0
      - field: "speed_score"        # å“åº”é€Ÿåº¦è¯„åˆ†
        order: "desc"
        weight: 0.9
      - field: "quota_remaining"    # å‰©ä½™é…é¢æ¯”ä¾‹
        order: "desc"
        weight: 0.7
        
    # ç­›é€‰æ¡ä»¶
    filters:
      max_cost_per_1k: 0.0         # åªè¦å…è´¹æ¨¡å‹
      min_context_length: 4000     # æœ€å°ä¸Šä¸‹æ–‡é•¿åº¦
      
    # æ¸ é“é…ç½®
    channels:
      - provider: "groq"
        model: "llama-3.1-8b-instant"
        priority: 1
        weight: 1.5
        daily_limit: 1000
        
      - provider: "openrouter"
        model: "meta-llama/llama-3.1-8b-instruct:free"
        priority: 2
        weight: 1.0
        daily_limit: 1000

# å…·ä½“Provideré…ç½®ã€APIå¯†é’¥ç®¡ç†é€šè¿‡æ•°æ®åº“åŠ¨æ€ç®¡ç†
# æ”¯æŒå®æ—¶æ·»åŠ /ç¼–è¾‘ï¼Œæ— éœ€é‡å¯æœåŠ¡
```

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€APIè°ƒç”¨
```bash
curl http://localhost:8000/v1/chat/completions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer your-api-key" \
  -d '{
    "model": "auto:free",  # ä½¿ç”¨å…è´¹æ¨¡å‹ç»„
    "messages": [{
      "role": "user", 
      "content": "Hello!"
    }]
  }'

# å…¶ä»–é¢„å®šä¹‰æ¨¡å‹ç»„ç¤ºä¾‹
# auto:fast    - é€Ÿåº¦ä¼˜å…ˆ(è¿½æ±‚æœ€å¿«å“åº”)
# auto:smart   - è´¨é‡ä¼˜å…ˆ(è¿½æ±‚æœ€ä½³æ•ˆæœ)  
# auto:cheap   - æˆæœ¬ä¼˜å…ˆ(è¿½æ±‚æœ€ä½³æ€§ä»·æ¯”)
# auto:tools   - å·¥å…·è°ƒç”¨æ¨¡å‹ç»„(æ”¯æŒfunction calling)
# auto:vision  - å¤šæ¨¡æ€æ¨¡å‹ç»„(æ”¯æŒå›¾åƒå¤„ç†)
# auto:code    - ä»£ç åŠ©æ‰‹æ¨¡å‹ç»„(ä¸“é—¨ç”¨äºä»£ç ç”Ÿæˆ)
# auto:chinese - ä¸­æ–‡ä¼˜åŒ–æ¨¡å‹ç»„(ä¸­æ–‡ç†è§£å’Œç”Ÿæˆ)
```

### Pythonå®¢æˆ·ç«¯
```python
import openai

# ä½¿ç”¨æ¨¡å‹ç»„ï¼Œç³»ç»Ÿè‡ªåŠ¨ä»ç»„å†…é€‰æ‹©æœ€ä¼˜æ¸ é“
client = openai.Client(
    api_key="your-api-key",
    base_url="http://localhost:8000/v1"
)

# ä½¿ç”¨å…è´¹æ¨¡å‹ç»„
response = client.chat.completions.create(
    model="auto:free",  # å…è´¹æ¨¡å‹ç»„
    messages=[{"role": "user", "content": "Hello!"}]
)

# ä½¿ç”¨å¿«é€Ÿæ¨¡å‹ç»„
response = client.chat.completions.create(
    model="auto:fast",  # é€Ÿåº¦ä¼˜å…ˆæ¨¡å‹ç»„
    messages=[{"role": "user", "content": "Hello!"}]
)
```

## ğŸ“Š æ ¸å¿ƒä¼˜åŠ¿

### ğŸ’° æˆæœ¬ä¼˜åŒ–
- **åŠ¨æ€ä»·æ ¼ç­–ç•¥** - æ”¯æŒæ—¶é—´æ®µã€é…é¢ä½¿ç”¨ç‡ã€éœ€æ±‚ç­‰å¤šç§ä»·æ ¼è°ƒæ•´
- **å¤šå±‚é¢„ç®—æ§åˆ¶** - Model Groupã€Channelã€ç”¨æˆ·ç­‰å¤šå±‚æ¬¡é¢„ç®—ç®¡ç†
- **æˆæœ¬é€æ˜åŒ–** - è¯¦ç»†çš„æˆæœ¬åˆ†è§£ã€è¶‹åŠ¿åˆ†æå’Œé¢„æµ‹

### ğŸ§  æ™ºèƒ½è·¯ç”±  
- **å¤šå±‚æ’åºç­–ç•¥** - æ”¯æŒæˆæœ¬ã€é€Ÿåº¦ã€è´¨é‡ã€å¯é æ€§ç­‰å¤šå› å­ç»„åˆè·¯ç”±
- **èƒ½åŠ›ç­›é€‰è·¯ç”±** - åŸºäºfunction_callingã€visionã€code_generationç­‰èƒ½åŠ›è¿‡æ»¤
- **åŠ¨æ€æƒé‡è°ƒæ•´** - åŸºäºå®æ—¶æ€§èƒ½æ•°æ®å’Œå¥åº·çŠ¶æ€çš„åŠ¨æ€æƒé‡

### ğŸ›¡ï¸ é«˜å¯ç”¨æ€§
- **æ™ºèƒ½é”™è¯¯åˆ†ç±»** - åŒºåˆ†æ°¸ä¹…/ä¸´æ—¶é”™è¯¯ï¼Œç²¾ç¡®çš„å†·å´å’Œæ¢å¤ç­–ç•¥
- **ç†”æ–­å™¨æ¨¡å¼** - é˜²æ­¢çº§è”æ•…éšœçš„Circuit Breakerå®ç°
- **å¤šProvideræ•…éšœè½¬ç§»** - è·¨Providerçš„æ— ç¼æ•…éšœè½¬ç§»

## ğŸ—ºï¸ å¼€å‘è·¯çº¿å›¾

- [x] **Phase 1** - æ ¸å¿ƒæ¶æ„å’ŒåŸºç¡€åŠŸèƒ½
- [x] **Phase 2** - æ™ºèƒ½è·¯ç”±å¼•æ“
- [ ] **Phase 3** - Webç®¡ç†ç•Œé¢
- [ ] **Phase 4** - é«˜çº§ç›‘æ§å’Œåˆ†æ
- [ ] **Phase 5** - éƒ¨ç½²å’Œè¿ç»´å·¥å…·

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“„ è®¸å¯è¯

MIT License

---

**è®©AI APIè°ƒç”¨æ›´æ™ºèƒ½ã€æ›´ç»æµã€æ›´å¯é ï¼** ğŸ¯