# é¡¹ç›®ç›®å½•ç»“æ„è¯´æ˜

## å®Œæ•´ç›®å½•ç»“æ„

```
smart-ai-router/
â”œâ”€â”€ ğŸ“ api/                          # FastAPIè·¯ç”±æ¥å£
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ admin.py                     # ç®¡ç†å‘˜æ¥å£
â”‚   â”œâ”€â”€ chat.py                      # OpenAIå…¼å®¹èŠå¤©æ¥å£
â”‚   â”œâ”€â”€ health.py                    # å¥åº·æ£€æŸ¥æ¥å£
â”‚   â””â”€â”€ management.py                # åŠ¨æ€é…ç½®ç®¡ç†æ¥å£
â”‚
â”œâ”€â”€ ğŸ“ config/                       # åˆ†å±‚é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ example.yaml                 # ä¸»é…ç½®æ–‡ä»¶æ¨¡æ¿
â”‚   â”œâ”€â”€ providers.yaml               # Provideré…ç½® (OpenAIã€Anthropicç­‰)
â”‚   â”œâ”€â”€ model_groups.yaml           # Model Groupé…ç½® (auto:freeç­‰)
â”‚   â”œâ”€â”€ system.yaml                 # ç³»ç»Ÿé…ç½® (ç›‘æ§ã€å®šæ—¶ä»»åŠ¡ç­‰)
â”‚   â””â”€â”€ pricing_policies.yaml       # åŠ¨æ€ä»·æ ¼ç­–ç•¥
â”‚
â”œâ”€â”€ ğŸ“ core/                         # æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ models/                   # SQLAlchemyæ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ __init__.py              # å¯¼å‡ºæ‰€æœ‰æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ base.py                  # åŸºç¡€é…ç½®å’Œä¼šè¯ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ provider.py              # Providerè¡¨æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ channel.py               # Channelè¡¨æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ model_group.py           # Model Groupç›¸å…³è¡¨æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ api_key.py               # APIå¯†é’¥ç›¸å…³è¡¨æ¨¡å‹
â”‚   â”‚   â””â”€â”€ stats.py                 # ç»Ÿè®¡å’Œæ—¥å¿—è¡¨æ¨¡å‹
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ router/                   # æ™ºèƒ½è·¯ç”±å¼•æ“
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ ğŸ“ strategies/           # è·¯ç”±ç­–ç•¥å®ç°
â”‚   â”‚       â”œâ”€â”€ __init__.py          # å¯¼å‡ºæ‰€æœ‰ç­–ç•¥
â”‚   â”‚       â”œâ”€â”€ base.py              # åŸºç¡€ç­–ç•¥æ¥å£
â”‚   â”‚       â”œâ”€â”€ multi_layer.py       # å¤šå±‚è·¯ç”±ç­–ç•¥
â”‚   â”‚       â”œâ”€â”€ cost_strategy.py     # æˆæœ¬ä¼˜åŒ–ç­–ç•¥
â”‚   â”‚       â”œâ”€â”€ speed_strategy.py    # é€Ÿåº¦ä¼˜åŒ–ç­–ç•¥
â”‚   â”‚       â”œâ”€â”€ quality_strategy.py  # è´¨é‡ä¼˜åŒ–ç­–ç•¥
â”‚   â”‚       â”œâ”€â”€ load_balance_strategy.py # è´Ÿè½½å‡è¡¡ç­–ç•¥
â”‚   â”‚       â””â”€â”€ capability_filter.py # èƒ½åŠ›ç­›é€‰å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ providers/                # Provideré€‚é…å™¨
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ ğŸ“ adapters/             # å„Provideré€‚é…å™¨å®ç°
â”‚   â”‚       â”œâ”€â”€ __init__.py          # å¯¼å‡ºæ‰€æœ‰é€‚é…å™¨
â”‚   â”‚       â”œâ”€â”€ base.py              # åŸºç¡€é€‚é…å™¨æ¥å£
â”‚   â”‚       â”œâ”€â”€ openai_adapter.py    # OpenAIé€‚é…å™¨
â”‚   â”‚       â”œâ”€â”€ anthropic_adapter.py # Anthropicé€‚é…å™¨
â”‚   â”‚       â”œâ”€â”€ groq_adapter.py      # Groqé€‚é…å™¨
â”‚   â”‚       â”œâ”€â”€ openrouter_adapter.py # OpenRouteré€‚é…å™¨
â”‚   â”‚       â”œâ”€â”€ siliconflow_adapter.py # ç¡…åŸºæµåŠ¨é€‚é…å™¨
â”‚   â”‚       â””â”€â”€ tuzi_adapter.py      # å…”å­APIé€‚é…å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ manager/                  # ä¸šåŠ¡ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ channel_manager.py       # æ¸ é“ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ model_group_manager.py   # æ¨¡å‹ç»„ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ api_key_manager.py       # APIå¯†é’¥ç®¡ç†å™¨
â”‚   â”‚   â””â”€â”€ cost_manager.py          # æˆæœ¬ç®¡ç†å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ scheduler/                # å®šæ—¶ä»»åŠ¡ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ __init__.py              # å¯¼å‡ºä»»åŠ¡å’Œè°ƒåº¦å™¨
â”‚   â”‚   â”œâ”€â”€ scheduler.py             # ä»»åŠ¡è°ƒåº¦å™¨
â”‚   â”‚   â””â”€â”€ jobs.py                  # å„ç§å®šæ—¶ä»»åŠ¡å®ç°
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ utils/                    # å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ config.py                # é…ç½®åŠ è½½å™¨
â”‚       â”œâ”€â”€ logger.py                # æ—¥å¿—é…ç½®
â”‚       â”œâ”€â”€ security.py              # å®‰å…¨å·¥å…·
â”‚       â””â”€â”€ validation.py            # æ•°æ®éªŒè¯
â”‚
â”œâ”€â”€ ğŸ“ web/                          # Webç®¡ç†ç•Œé¢ (å¯é€‰)
â”‚   â”œâ”€â”€ ğŸ“ static/                   # é™æ€èµ„æº
â”‚   â””â”€â”€ ğŸ“ templates/                # æ¨¡æ¿æ–‡ä»¶
â”‚
â”œâ”€â”€ ğŸ“ tests/                        # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ test_api/                    # APIæµ‹è¯•
â”‚   â”œâ”€â”€ test_core/                   # æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•
â”‚   â”œâ”€â”€ test_integration/            # é›†æˆæµ‹è¯•
â”‚   â””â”€â”€ conftest.py                  # æµ‹è¯•é…ç½®
â”‚
â”œâ”€â”€ ğŸ“ migrations/                   # æ•°æ®åº“è¿ç§»
â”‚   â””â”€â”€ versions/                    # è¿ç§»ç‰ˆæœ¬æ–‡ä»¶
â”‚
â”œâ”€â”€ ğŸ“ logs/                         # æ—¥å¿—æ–‡ä»¶ç›®å½•
â”‚
â”œâ”€â”€ ğŸ“ docs/                         # é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ api.md                       # APIæ–‡æ¡£
â”‚   â”œâ”€â”€ deployment.md                # éƒ¨ç½²æŒ‡å—
â”‚   â””â”€â”€ development.md               # å¼€å‘æŒ‡å—
â”‚
â”œâ”€â”€ ğŸ“„ main.py                       # åº”ç”¨å…¥å£ç‚¹
â”œâ”€â”€ ğŸ“„ pyproject.toml                # Pythoné¡¹ç›®é…ç½®
â”œâ”€â”€ ğŸ“„ requirements.txt              # ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ ğŸ“„ uv.lock                       # UVé”å®šæ–‡ä»¶
â”œâ”€â”€ ğŸ“„ Dockerfile                    # Dockeré…ç½®
â”œâ”€â”€ ğŸ“„ docker-compose.yml            # Docker Composeé…ç½®
â”œâ”€â”€ ğŸ“„ .env.example                  # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ ğŸ“„ .gitignore                    # Gitå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ ğŸ“„ README.md                     # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ ğŸ“„ CLAUDE.md                     # Claudeå¼€å‘æŒ‡å—
â”œâ”€â”€ ğŸ“„ DATABASE_SCHEMA.md            # æ•°æ®åº“æ¶æ„æ–‡æ¡£
â””â”€â”€ ğŸ“„ DEVELOPMENT.md                # å¼€å‘æ–‡æ¡£
```

## æ ¸å¿ƒæ¶æ„è¯´æ˜

### ğŸ—ï¸ Provider/Channel/Model Group ä¸‰å±‚æ¶æ„

1. **Providerå±‚**: AIæœåŠ¡æä¾›å•† (OpenAIã€Anthropicç­‰)
2. **Channelå±‚**: å…·ä½“çš„APIç«¯ç‚¹é…ç½® (æ¨¡å‹ã€å¯†é’¥ã€é™é¢ç­‰)  
3. **Model Groupå±‚**: ç»Ÿä¸€çš„æ¨¡å‹ç»„åˆ (auto:freeã€auto:fastç­‰)

### ğŸ“Š æ•°æ®æ¨¡å‹å…³ç³»

- **providers** â† **channels** â† **api_keys**
- **virtual_model_groups** â†â†’ **model_group_channels** â†â†’ **channels**
- **request_logs** â†’ **channels**, **api_keys**, **router_api_keys**
- **channel_stats** â†’ **channels**

### ğŸ¯ é…ç½®ç®¡ç†ç­–ç•¥

- **é™æ€é…ç½®**: YAMLæ–‡ä»¶ (ç³»ç»Ÿè®¾ç½®ã€Providerå®šä¹‰ã€Model Groupæ¨¡æ¿)
- **åŠ¨æ€é…ç½®**: æ•°æ®åº“ (æ¸ é“ã€APIå¯†é’¥ã€å®æ—¶ç»Ÿè®¡)
- **ç¯å¢ƒå˜é‡**: ç³»ç»Ÿå¯†é’¥å’Œè¿æ¥ä¿¡æ¯

### ğŸš€ æ ¸å¿ƒç‰¹æ€§å®ç°

1. **å¤šå±‚è·¯ç”±ç­–ç•¥**: `core/router/strategies/`
2. **Provideré€‚é…å™¨**: `core/providers/adapters/`  
3. **å®šæ—¶ä»»åŠ¡ç³»ç»Ÿ**: `core/scheduler/`
4. **åŠ¨æ€é…ç½®ç®¡ç†**: `api/management.py`
5. **æ™ºèƒ½æ•…éšœå¤„ç†**: é›†æˆåœ¨è·¯ç”±å¼•æ“ä¸­

## å¼€å‘å·¥ä½œæµç¨‹

1. **é…ç½®**: ç¼–è¾‘ `config/*.yaml` å®šä¹‰Providerå’ŒModel Group
2. **é€‚é…å™¨**: å®ç° `core/providers/adapters/` ä¸­çš„Provideré€‚é…å™¨
3. **è·¯ç”±ç­–ç•¥**: æ‰©å±• `core/router/strategies/` ä¸­çš„è·¯ç”±ç®—æ³•
4. **ç®¡ç†æ¥å£**: å®Œå–„ `api/management.py` çš„åŠ¨æ€é…ç½®åŠŸèƒ½
5. **ç›‘æ§**: å®ç° `core/scheduler/` ä¸­çš„å®šæ—¶ä»»åŠ¡

## éƒ¨ç½²æ¶æ„

- **å¼€å‘ç¯å¢ƒ**: SQLite + å†…å­˜ç¼“å­˜
- **ç”Ÿäº§ç¯å¢ƒ**: PostgreSQL + Redis + è´Ÿè½½å‡è¡¡
- **å®¹å™¨åŒ–**: Docker + Docker Compose
- **ç›‘æ§**: å†…ç½®å¥åº·æ£€æŸ¥ + å¤–éƒ¨ç›‘æ§é›†æˆ