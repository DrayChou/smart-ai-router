# é¡¹ç›®ç›®å½•ç»“æ„è¯´æ˜

## å®Œæ•´ç›®å½•ç»“æ„ (å·²é‡æ–°ç»„ç»‡)

```
smart-ai-router/
â”œâ”€â”€ ğŸ“ api/                          # FastAPIè·¯ç”±æ¥å£
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ ğŸ“ admin/                    # ç®¡ç†å‘˜APIæ¥å£
â”‚       â””â”€â”€ siliconflow.py           # SiliconFlowç®¡ç†æ¥å£
â”‚
â”œâ”€â”€ ğŸ“ cache/                        # ç¼“å­˜ç›®å½•
â”‚   â”œâ”€â”€ ğŸ“ channels/                 # å„æ¸ é“ç¼“å­˜æ–‡ä»¶
â”‚   â”œâ”€â”€ discovered_models.json      # å·²å‘ç°çš„æ¨¡å‹ç¼“å­˜
â”‚   â”œâ”€â”€ health_history.json         # å¥åº·æ£€æŸ¥å†å²
â”‚   â”œâ”€â”€ model_pricing.json          # æ¨¡å‹å®šä»·ç¼“å­˜
â”‚   â””â”€â”€ smart_cache.json            # æ™ºèƒ½ç¼“å­˜
â”‚
â”œâ”€â”€ ğŸ“ config/                       # é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ README.md                    # é…ç½®æ–‡ä»¶è¯´æ˜
â”‚   â”œâ”€â”€ providers.yaml               # Provideré…ç½®
â”‚   â”œâ”€â”€ router_config.yaml           # ä¸»é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ router_config.yaml.template  # é…ç½®æ¨¡æ¿
â”‚   â”œâ”€â”€ synced_config.yaml           # åŒæ­¥é…ç½®
â”‚   â”œâ”€â”€ test_config.yaml             # æµ‹è¯•é…ç½®
â”‚   â””â”€â”€ working_config.yaml          # å·¥ä½œé…ç½®
â”‚
â”œâ”€â”€ ğŸ“ core/                         # æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ auth.py                      # è®¤è¯æ¨¡å—
â”‚   â”œâ”€â”€ config_loader.py             # é…ç½®åŠ è½½å™¨
â”‚   â”œâ”€â”€ config_models.py             # Pydanticé…ç½®æ¨¡å‹
â”‚   â”œâ”€â”€ database.py                  # æ•°æ®åº“é…ç½®
â”‚   â”œâ”€â”€ exceptions.py                # è‡ªå®šä¹‰å¼‚å¸¸
â”‚   â”œâ”€â”€ json_router.py               # æ ¸å¿ƒè·¯ç”±å¼•æ“
â”‚   â”œâ”€â”€ yaml_config.py               # YAMLé…ç½®åŠ è½½å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ handlers/                 # è¯·æ±‚å¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ chat_handler.py          # èŠå¤©è¯·æ±‚å¤„ç†å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ manager/                  # ä¸šåŠ¡ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ channel_manager.py       # æ¸ é“ç®¡ç†å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ models/                   # SQLAlchemyæ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ api_key.py               # APIå¯†é’¥æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ base.py                  # åŸºç¡€æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ channel.py               # æ¸ é“æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ cost.py                  # æˆæœ¬æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ model_group.py           # æ¨¡å‹ç»„æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ provider.py              # Provideræ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ request_log.py           # è¯·æ±‚æ—¥å¿—æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ stats.py                 # ç»Ÿè®¡æ¨¡å‹
â”‚   â”‚   â””â”€â”€ virtual_model.py         # è™šæ‹Ÿæ¨¡å‹
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ providers/                # Provideré€‚é…å™¨
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py                  # åŸºç¡€é€‚é…å™¨æ¥å£
â”‚   â”‚   â”œâ”€â”€ registry.py              # é€‚é…å™¨æ³¨å†Œå™¨
â”‚   â”‚   â””â”€â”€ ğŸ“ adapters/             # å„Provideré€‚é…å™¨å®ç°
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ anthropic.py         # Anthropicé€‚é…å™¨
â”‚   â”‚       â”œâ”€â”€ groq.py              # Groqé€‚é…å™¨
â”‚   â”‚       â”œâ”€â”€ openai.py            # OpenAIé€‚é…å™¨
â”‚   â”‚       â””â”€â”€ siliconflow.py       # SiliconFlowé€‚é…å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ router/                   # è·¯ç”±ç­–ç•¥
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py                  # åŸºç¡€è·¯ç”±æ¥å£
â”‚   â”‚   â””â”€â”€ ğŸ“ strategies/           # è·¯ç”±ç­–ç•¥å®ç°
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ cost_optimized.py    # æˆæœ¬ä¼˜åŒ–ç­–ç•¥
â”‚   â”‚       â”œâ”€â”€ multi_layer.py       # å¤šå±‚è·¯ç”±ç­–ç•¥
â”‚   â”‚       â””â”€â”€ speed_optimized.py   # é€Ÿåº¦ä¼˜åŒ–ç­–ç•¥
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ scheduler/                # å®šæ—¶ä»»åŠ¡ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ scheduler.py             # ä»»åŠ¡è°ƒåº¦å™¨
â”‚   â”‚   â”œâ”€â”€ task_manager.py          # ä»»åŠ¡ç®¡ç†å™¨
â”‚   â”‚   â””â”€â”€ ğŸ“ tasks/                # å„ç§å®šæ—¶ä»»åŠ¡
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ model_discovery.py   # æ¨¡å‹å‘ç°ä»»åŠ¡
â”‚   â”‚       â”œâ”€â”€ official_pricing.py  # å®˜æ–¹å®šä»·ä»»åŠ¡
â”‚   â”‚       â”œâ”€â”€ pricing_discovery.py # å®šä»·å‘ç°ä»»åŠ¡
â”‚   â”‚       â”œâ”€â”€ pricing_extractor.py # å®šä»·æå–å™¨
â”‚   â”‚       â”œâ”€â”€ service_health_check.py # å¥åº·æ£€æŸ¥ä»»åŠ¡
â”‚   â”‚       â””â”€â”€ siliconflow_pricing.py # SiliconFlowå®šä»·ä»»åŠ¡
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ utils/                    # å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ api_key_validator.py     # APIå¯†é’¥éªŒè¯å™¨
â”‚       â”œâ”€â”€ channel_cache_manager.py # æ¸ é“ç¼“å­˜ç®¡ç†å™¨
â”‚       â”œâ”€â”€ config.py                # é…ç½®å·¥å…·
â”‚       â”œâ”€â”€ http_client_pool.py      # HTTPå®¢æˆ·ç«¯æ± 
â”‚       â”œâ”€â”€ logger.py                # æ—¥å¿—é…ç½®
â”‚       â”œâ”€â”€ model_analyzer.py        # æ¨¡å‹åˆ†æå™¨
â”‚       â”œâ”€â”€ smart_cache.py           # æ™ºèƒ½ç¼“å­˜
â”‚       â””â”€â”€ token_counter.py         # Tokenè®¡æ•°å™¨
â”‚
â”œâ”€â”€ ğŸ“ docs/                         # é¡¹ç›®æ–‡æ¡£ (å·²é‡æ–°ç»„ç»‡)
â”‚   â”œâ”€â”€ DATABASE_SCHEMA.md           # æ•°æ®åº“æ¶æ„
â”‚   â”œâ”€â”€ PROJECT_STRUCTURE.md         # é¡¹ç›®ç»“æ„è¯´æ˜
â”‚   â”œâ”€â”€ api.md                       # APIæ–‡æ¡£
â”‚   â”œâ”€â”€ architecture.md              # ç³»ç»Ÿæ¶æ„
â”‚   â”œâ”€â”€ background_tasks.md          # åå°ä»»åŠ¡è¯´æ˜
â”‚   â”œâ”€â”€ build.md                     # æ„å»ºè¯´æ˜
â”‚   â”œâ”€â”€ channel_pricing_analysis.md  # æ¸ é“å®šä»·åˆ†æ
â”‚   â”œâ”€â”€ code_quality_report.md       # ä»£ç è´¨é‡æŠ¥å‘Š
â”‚   â”œâ”€â”€ configuration.md             # é…ç½®è¯´æ˜
â”‚   â”œâ”€â”€ deployment.md                # éƒ¨ç½²æŒ‡å—
â”‚   â”œâ”€â”€ development.md               # å¼€å‘æŒ‡å—
â”‚   â”œâ”€â”€ development_summary.md       # å¼€å‘æ€»ç»“
â”‚   â”œâ”€â”€ gemini.md                    # Geminié›†æˆè¯´æ˜
â”‚   â”œâ”€â”€ performance_optimizations.md # æ€§èƒ½ä¼˜åŒ–
â”‚   â”œâ”€â”€ pricing_system.md            # å®šä»·ç³»ç»Ÿè¯´æ˜
â”‚   â””â”€â”€ project_review_and_fixes.md  # é¡¹ç›®å›é¡¾å’Œä¿®å¤
â”‚
â”œâ”€â”€ ğŸ“ logs/                         # æ—¥å¿—æ–‡ä»¶ç›®å½•
â”‚   â””â”€â”€ ğŸ“ siliconflow_pricing/      # SiliconFlowå®šä»·ç›¸å…³æ–‡ä»¶
â”‚       â”œâ”€â”€ å¤§æ¨¡å‹ API ä»·æ ¼æ–¹æ¡ˆ - ç¡…åŸºæµåŠ¨ SiliconFlow.html
â”‚       â””â”€â”€ å¤§æ¨¡å‹ API ä»·æ ¼æ–¹æ¡ˆ - ç¡…åŸºæµåŠ¨ SiliconFlow_files/
â”‚
â”œâ”€â”€ ğŸ“ scripts/                      # å·¥å…·è„šæœ¬ (å·²é‡æ–°ç»„ç»‡)
â”‚   â”œâ”€â”€ analyze_routing_strategy.py  # è·¯ç”±ç­–ç•¥åˆ†æ
â”‚   â”œâ”€â”€ debug_routing.py             # è·¯ç”±è°ƒè¯•
â”‚   â”œâ”€â”€ debug_tag_matching.py        # æ ‡ç­¾åŒ¹é…è°ƒè¯•
â”‚   â”œâ”€â”€ demo_tag_system.py           # æ ‡ç­¾ç³»ç»Ÿæ¼”ç¤º
â”‚   â”œâ”€â”€ fix_config.py                # é…ç½®ä¿®å¤å·¥å…·
â”‚   â”œâ”€â”€ import_oneapi_channels.py    # OneAPIæ¸ é“å¯¼å…¥
â”‚   â”œâ”€â”€ import_oneapi_data.py        # OneAPIæ•°æ®å¯¼å…¥
â”‚   â”œâ”€â”€ migrate_cache.py             # ç¼“å­˜è¿ç§»å·¥å…·
â”‚   â”œâ”€â”€ run_model_discovery.py       # è¿è¡Œæ¨¡å‹å‘ç°
â”‚   â”œâ”€â”€ simple_test.py               # ç®€å•æµ‹è¯•
â”‚   â””â”€â”€ sync_oneapi_channels.py      # OneAPIæ¸ é“åŒæ­¥
â”‚
â”œâ”€â”€ ğŸ“ tests/                        # æµ‹è¯•æ–‡ä»¶ (å·²é‡æ–°ç»„ç»‡)
â”‚   â”œâ”€â”€ test_api_fix.py              # APIä¿®å¤æµ‹è¯•
â”‚   â”œâ”€â”€ test_api_key_validation.py   # APIå¯†é’¥éªŒè¯æµ‹è¯•
â”‚   â”œâ”€â”€ test_background_tasks.py     # åå°ä»»åŠ¡æµ‹è¯•
â”‚   â”œâ”€â”€ test_cache_consistency.py    # ç¼“å­˜ä¸€è‡´æ€§æµ‹è¯•
â”‚   â”œâ”€â”€ test_debug_headers.py        # è°ƒè¯•å¤´æµ‹è¯•
â”‚   â”œâ”€â”€ test_detailed_logging.py     # è¯¦ç»†æ—¥å¿—æµ‹è¯•
â”‚   â”œâ”€â”€ test_health_check.py         # å¥åº·æ£€æŸ¥æµ‹è¯•
â”‚   â”œâ”€â”€ test_negative_local_only.json # è´Ÿé¢æœ¬åœ°æµ‹è¯•æ•°æ®
â”‚   â”œâ”€â”€ test_negative_tag_parsing.py # è´Ÿé¢æ ‡ç­¾è§£ææµ‹è¯•
â”‚   â”œâ”€â”€ test_negative_tags.json      # è´Ÿé¢æ ‡ç­¾æµ‹è¯•æ•°æ®
â”‚   â”œâ”€â”€ test_official_pricing.py     # å®˜æ–¹å®šä»·æµ‹è¯•
â”‚   â”œâ”€â”€ test_optimizations.py        # ä¼˜åŒ–æµ‹è¯•
â”‚   â”œâ”€â”€ test_performance.py          # æ€§èƒ½æµ‹è¯•
â”‚   â”œâ”€â”€ test_phase1.py               # ç¬¬ä¸€é˜¶æ®µæµ‹è¯•
â”‚   â”œâ”€â”€ test_pricing_extraction.py   # å®šä»·æå–æµ‹è¯•
â”‚   â”œâ”€â”€ test_pricing_integration.py  # å®šä»·é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ test_routing_logic.py        # è·¯ç”±é€»è¾‘æµ‹è¯•
â”‚   â”œâ”€â”€ test_simple_discovery.py     # ç®€å•å‘ç°æµ‹è¯•
â”‚   â”œâ”€â”€ test_tag_error_handling.py   # æ ‡ç­¾é”™è¯¯å¤„ç†æµ‹è¯•
â”‚   â”œâ”€â”€ test_tag_fix.py              # æ ‡ç­¾ä¿®å¤æµ‹è¯•
â”‚   â””â”€â”€ test_tag_system.py           # æ ‡ç­¾ç³»ç»Ÿæµ‹è¯•
â”‚
â”œâ”€â”€ ğŸ“ web/                          # Webç®¡ç†ç•Œé¢ (é¢„ç•™)
â”‚   â”œâ”€â”€ ğŸ“ static/                   # é™æ€èµ„æº
â”‚   â””â”€â”€ ğŸ“ templates/                # æ¨¡æ¿æ–‡ä»¶
â”‚
â”œâ”€â”€ ğŸ“„ main.py                       # åº”ç”¨å…¥å£ç‚¹
â”œâ”€â”€ ğŸ“„ pyproject.toml                # Pythoné¡¹ç›®é…ç½®
â”œâ”€â”€ ğŸ“„ requirements.txt              # ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ ğŸ“„ uv.lock                       # UVé”å®šæ–‡ä»¶
â”œâ”€â”€ ğŸ“„ Dockerfile                    # Dockeré…ç½®
â”œâ”€â”€ ğŸ“„ docker-compose.yml            # Docker Composeé…ç½®
â”œâ”€â”€ ğŸ“„ CLAUDE.md                     # Claudeå¼€å‘æŒ‡å—
â”œâ”€â”€ ğŸ“„ README.md                     # é¡¹ç›®è¯´æ˜
â””â”€â”€ ğŸ“„ TODO.md                       # ä»»åŠ¡åˆ—è¡¨
```

## æ ¸å¿ƒæ¶æ„è¯´æ˜

### ğŸ—ï¸ æ™ºèƒ½æ ‡ç­¾åŒ–è·¯ç”±ç³»ç»Ÿ

Smart AI Router é‡‡ç”¨**åŸºäºæ¨¡å‹åç§°çš„è‡ªåŠ¨æ ‡ç­¾åŒ–ç³»ç»Ÿ**ï¼Œå®Œå…¨æ›¿ä»£äº†ä¼ ç»Ÿçš„ Model Groups æ¦‚å¿µï¼š

1. **è‡ªåŠ¨æ ‡ç­¾æå–**: ä»æ¨¡å‹åç§°ä¸­è‡ªåŠ¨æå–æ ‡ç­¾
2. **æ™ºèƒ½åŒ¹é…**: æ”¯æŒå¤šæ ‡ç­¾ç»„åˆæŸ¥è¯¢ (å¦‚ `tag:gpt,free`)
3. **å®æ—¶è·¯ç”±**: åŸºäºæ ‡ç­¾è¿›è¡Œæ™ºèƒ½è·¯ç”±é€‰æ‹©

### ğŸ“Š å¤šå±‚è·¯ç”±ç­–ç•¥

æ”¯æŒå…­ç§è·¯ç”±ç­–ç•¥ï¼Œå¯åŠ¨æ€åˆ‡æ¢ï¼š
- `cost_first`: æˆæœ¬ä¼˜å…ˆ
- `free_first`: å…è´¹èµ„æºä¼˜å…ˆ  
- `local_first`: æœ¬åœ°æ¨¡å‹ä¼˜å…ˆ
- `balanced`: å¹³è¡¡ç­–ç•¥
- `speed_optimized`: é€Ÿåº¦ä¼˜åŒ–
- `quality_optimized`: è´¨é‡ä¼˜åŒ–

### ğŸ”§ æ•°æ®æ¨¡å‹å…³ç³»

```
Provider (OpenAI, Anthropic, etc.)
    â†“
Channel (å…·ä½“APIç«¯ç‚¹é…ç½®)
    â†“
Model (ç‰©ç†æ¨¡å‹)
    â†“
Tag-based Routing (æ ‡ç­¾åŒ–è·¯ç”±)
```

### ğŸš€ ä¸»è¦ç‰¹æ€§

- **Phase 7 æˆæœ¬ä¼˜åŒ–**: å…è´¹èµ„æºæœ€å¤§åŒ–ã€æœ¬åœ°æ¨¡å‹ä¼˜å…ˆ
- **å®æ—¶æˆæœ¬è¿½è¸ª**: é€æ˜çš„æˆæœ¬è®¡ç®—å’Œæ˜¾ç¤º
- **æ™ºèƒ½æ•…éšœè½¬ç§»**: è‡ªåŠ¨é”™è¯¯æ£€æµ‹å’Œæ¸ é“åˆ‡æ¢
- **å®šæ—¶ä»»åŠ¡ç³»ç»Ÿ**: æ¨¡å‹å‘ç°ã€å®šä»·æ›´æ–°ã€å¥åº·æ£€æŸ¥
- **ç®¡ç†API**: åŠ¨æ€é…ç½®ç®¡ç†å’Œç›‘æ§

## æ–‡ä»¶ç»„ç»‡å˜æ›´

### âœ… å·²å®Œæˆçš„é‡æ–°ç»„ç»‡

1. **æ–‡æ¡£é›†ä¸­åŒ–**: æ‰€æœ‰ `*.md` æ–‡ä»¶ç§»åŠ¨åˆ° `docs/` ç›®å½•
2. **æµ‹è¯•é›†ä¸­åŒ–**: æ‰€æœ‰ `test_*.py` å’Œ `test_*.json` æ–‡ä»¶ç§»åŠ¨åˆ° `tests/` ç›®å½•  
3. **è„šæœ¬é›†ä¸­åŒ–**: æ‰€æœ‰å·¥å…·è„šæœ¬ç§»åŠ¨åˆ° `scripts/` ç›®å½•
4. **æ—¥å¿—ç»“æ„åŒ–**: `logs/` ç›®å½•ä¸‹åˆ›å»ºåˆ†ç±»å­ç›®å½•
5. **æ¸…ç†æ ¹ç›®å½•**: åˆ é™¤å¤‡ä»½æ–‡ä»¶å’Œä¸´æ—¶æ–‡ä»¶

### ğŸ“ˆ æ¶æ„ä¼˜åŠ¿

- **æ¨¡å—åŒ–è®¾è®¡**: æ¸…æ™°çš„åŠŸèƒ½åˆ†ç¦»å’Œä¾èµ–å…³ç³»
- **å¯æ‰©å±•æ€§**: æ˜“äºæ·»åŠ æ–°çš„Providerå’Œè·¯ç”±ç­–ç•¥
- **å¯ç»´æŠ¤æ€§**: è‰¯å¥½çš„ä»£ç ç»„ç»‡å’Œæ–‡æ¡£ç»“æ„
- **Dockerå‹å¥½**: å®Œæ•´çš„å®¹å™¨åŒ–æ”¯æŒ
- **å¼€å‘å‹å¥½**: å®Œå–„çš„å¼€å‘å·¥å…·å’Œæµ‹è¯•å¥—ä»¶